CREATE DATABASE TRABALHO;
USE TRABALHO;

CREATE TABLE IF NOT EXISTS ALUNO (
	RA				INTEGER			NOT NULL,
	NOME_ALUNO		VARCHAR(250) 	NOT NULL,
	SEXO_ALUNO		VARCHAR(1),		-- F - FEMININO / M - MASCULINO
	CONSTRAINT PK_ALUNO PRIMARY KEY (RA),
	CONSTRAINT CK_SEXO_ALUNO CHECK (SEXO_ALUNO IN ('F', 'M'))
);

CREATE TABLE IF NOT EXISTS TURMA (
	NUM_TURMA					INTEGER			NOT NULL,
	DTA_INICIO_AULAS			DATE 			NOT NULL,
	DTA_FIM_AULAS				DATE 			NOT NULL,
	CONSTRAINT PK_TURMA PRIMARY KEY (NUM_TURMA)
);

CREATE TABLE IF NOT EXISTS DISCIPLINA (
	COD_DISCIPLINA				INTEGER			NOT NULL,
	NOM_DISCIPLINA				VARCHAR(250)	NOT NULL,
	CARGA_HORARIA				INTEGER  		NOT NULL,			  
	CONSTRAINT PK_DISCIPLINA PRIMARY KEY (COD_DISCIPLINA)
);

CREATE TABLE IF NOT EXISTS PROFESSOR (
	MATRICULA					INTEGER			NOT NULL,
	NOME_PROFESSOR				VARCHAR(250)	NOT NULL,
	TITULACAO					VARCHAR(100)	NOT NULL,
	SEXO_PROFESSOR				VARCHAR(1)		NOT NULL, -- F - FEMININO / M - MASCULINO			  
	CONSTRAINT PK_PROFESSOR PRIMARY KEY (MATRICULA),
	CONSTRAINT CK_SEXO_PROFESSOR CHECK (SEXO_PROFESSOR IN ('F', 'M'))
);

CREATE TABLE IF NOT EXISTS MATRICULA (
	NUM_MATRICULA				INTEGER			NOT NULL,
	DTA_MATRICULA				DATE 			NOT NULL,
	DTA_CANCELAMENTO_MATRICULA	DATE,
	RA							INTEGER			NOT NULL,
	NUM_TURMA					INTEGER			NOT NULL,
	CONSTRAINT PK_MATRICULA PRIMARY KEY (NUM_MATRICULA),
	CONSTRAINT FK_MATRICULA_ALUNO FOREIGN KEY (RA) REFERENCES ALUNO (RA),
	CONSTRAINT FK_MATRICULA_TURMA FOREIGN KEY (NUM_TURMA) REFERENCES TURMA (NUM_TURMA)	
);

CREATE TABLE IF NOT EXISTS AVALIACAO (
	SEQ_AVALIACAO_ALUNO			INTEGER			NOT NULL,
	NOTA_A2						DECIMAL(5,2)	NOT NULL, -- DEVE ESTAR ENTRE 0 E 5
	NOTA_A1						DECIMAL(5,2),			  -- DEVE ESTAR ENTRE 0 E 5
	NOTA_AF						DECIMAL(5,2),			  -- DEVE ESTAR ENTRE 0 E 5
	RA							INTEGER			NOT NULL,
 	NUM_DISCIPLINA_OFERECIDA	INTEGER			NOT NULL,
	CONSTRAINT PK_AVALIACAO PRIMARY KEY (SEQ_AVALIACAO_ALUNO),
	CONSTRAINT PK_AVALIACAO_ALUNO FOREIGN KEY (RA) REFERENCES ALUNO (RA)	
);

CREATE TABLE IF NOT EXISTS DISCIPLINA_OFERECIDA (
	NUM_DISCIPLINA_OFERECIDA	INTEGER			NOT NULL,
	SALA						VARCHAR(10)		NOT NULL,
	BLOCO						VARCHAR(10)		NOT NULL,
	DIA_SEMANA					INTEGER			NOT NULL, -- DEVE SER ENTRE 1-DOMINGO E 7-SABADO
	HOR_INICIO					TIME			NOT NULL,
	HOR_FIM						TIME			NOT NULL,
 	MATRICULA					INTEGER			NOT NULL,
	NUM_TURMA					INTEGER			NOT NULL,
	COD_DISCIPLINA				INTEGER			NOT NULL,
	CONSTRAINT PK_DISCIPLINA_OFERECIDA PRIMARY KEY (NUM_DISCIPLINA_OFERECIDA),
	CONSTRAINT PK_DISCIPLINA_OFERECIDA_PROFESSOR 
		FOREIGN KEY (MATRICULA) REFERENCES PROFESSOR (MATRICULA),
	CONSTRAINT FK_DISCIPLINA_OFERECIDA_TURMA FOREIGN KEY (NUM_TURMA) REFERENCES TURMA (NUM_TURMA),
	CONSTRAINT PK_DISCIPLINA_OFERECIDA_COD_DISCIPLINA 
		FOREIGN KEY (COD_DISCIPLINA) REFERENCES DISCIPLINA (COD_DISCIPLINA)
);

INSERT INTO TURMA (
	NUM_TURMA,
	DTA_INICIO_AULAS,
	DTA_FIM_AULAS) 
VALUES 
(1,'2022/08/01','2022/12/20'),
(2,'2023/02/13','2023/06/30');

-- INSERIR ALUNOS 3.1.2
INSERT INTO ALUNO (
	RA,
	NOME_ALUNO,
	SEXO_ALUNO)
VALUES 
-- TURMA A
(1, 'MIGUEL', 'M'),
(2, 'ARTHUR', 'M'),
(3, 'GAEL', 'M'),
(4, 'THEO', 'M'),
(5, 'HEITOR', 'M'),
(6, 'HELENA', 'F'),
(7, 'ALICE', 'F'),
(8, 'LAURA', 'F'),
(9, 'MARIA', 'F'),
(10, 'SOFIA', 'F'),
-- TURMA B
(11, 'RAVI', 'M'),
(12, 'DAVI', 'M'),
(13, 'BERNARDO', 'M'),
(14, 'NOAH', 'M'),
(15, 'GABRIEL', 'M'),
(16, 'MANUELA', 'F'),
(17, 'MAITE', 'F'),
(18, 'LIZ', 'F'),
(19, 'CECILIA', 'F'),
(20, 'ISABELA', 'F');

-- INSERIR MATRICULA 3.1.2
INSERT INTO MATRICULA (
	NUM_MATRICULA,
	DTA_MATRICULA,
	DTA_CANCELAMENTO_MATRICULA,
	RA,
	NUM_TURMA)
VALUES 
-- MATRICULA TURMA A 3.2.1
(1,'2022/06/10',NULL,1,1),
(2,'2022/06/11',NULL,2,1),
(3,'2022/06/12',NULL,3,1),
(4,'2022/06/13',NULL,4,1),
(5,'2022/06/14',NULL,5,1),
(6,'2022/06/15',NULL,6,1),
(7,'2022/06/16',NULL,7,1),
(8,'2022/06/17',NULL,8,1),
(9,'2022/06/17',NULL,9,1),
(10,'2022/06/17',NULL,10,1),
-- MATRICULA TURMA B 3.2.1
(11,'2023/01/17',NULL,11,2),
(12,'2023/01/18',NULL,12,2),
(13,'2023/01/19',NULL,13,2),
(14,'2023/01/20',NULL,14,2),
(15,'2023/01/21',NULL,15,2),
(16,'2023/01/22',NULL,16,2),
(17,'2023/01/22',NULL,17,2),
(18,'2023/01/23',NULL,18,2),
(19,'2023/01/24',NULL,19,2),
(20,'2023/01/25',NULL,20,2);

-- INSERIR PROFESSOR 3.1.3
INSERT INTO PROFESSOR (
	MATRICULA,
	NOME_PROFESSOR,
	TITULACAO,
	SEXO_PROFESSOR)
VALUES 
(01, 'Marcos Paulo', 'Professor Doutor','M'),
(02, 'Robson Toledo', 'Professor Mestre', 'M'),
(03, 'Marilia Costa', 'Professora Doutora', 'F'),
(04, 'Leticia Leite', 'Professora Especialista', 'F');

-- INSERIR DISCIPLINA 3.1.4
INSERT INTO DISCIPLINA (
	COD_DISCIPLINA,
	NOM_DISCIPLINA,
	CARGA_HORARIA
)
VALUES 
(001, 'Geografia', 200),
(002,'Biologia',200),
(003, 'Matematica',200),
(004, 'Portugues', 200);

-- INSERIR DISCIPLINA OFERECIDA
INSERT INTO DISCIPLINA_OFERECIDA (
	NUM_DISCIPLINA_OFERECIDA,
	SALA,
	BLOCO,
	DIA_SEMANA,
	HOR_INICIO,
	HOR_FIM,
	MATRICULA,
	NUM_TURMA,
	COD_DISCIPLINA)
VALUES 

-- DISCIPLINAS DA TURMA 1 3.2.2
(1, 'A', 'ALFA', 3, '07:00:00', '12:00:00', 01, 1, 001),
(2, 'A', 'ALFA', 4, '07:00:00', '12:00:00', 02, 1, 002),
(3, 'A', 'ALFA', 5, '07:00:00', '12:00:00', 03, 1, 003),
(4, 'A', 'ALFA', 6, '07:00:00', '12:00:00', 04, 1, 004),
-- DISCIPLINAS DA TURMA 2 3.2.2
(5, 'B', 'ALFA', 3, '07:00:00', '12:00:00', 04, 2, 004),
(6, 'B', 'ALFA', 4, '07:00:00', '12:00:00', 03, 2, 003),
(7, 'B', 'ALFA', 5, '07:00:00', '12:00:00', 02, 2, 002),
(8, 'B', 'ALFA', 6, '07:00:00', '12:00:00', 01, 2, 001);

-- INSERIR AVALIACAO DAS TURMAS 3.2.3 E 3.2.4
INSERT INTO AVALIACAO (
	SEQ_AVALIACAO_ALUNO,
	NOTA_A2,
	NOTA_A1,
	NOTA_AF,
	RA,
	NUM_DISCIPLINA_OFERECIDA)
VALUES 
-- AVALIACAO 10 ALUNOS DA TURMA A 3.2.3
(1, 4.75, 3.25, NULL, 1, 1), -- ap dir
(2, 4.75, 3.25, NULL, 1, 2),
(3, 4.75, 3.25, NULL, 1, 3),
(4, 4.75, 3.25, NULL, 1, 4),

(5, 0.50, 0.25, NULL, 2, 1), -- rep dir
(6, 0.50, 0.25, NULL, 2, 2),
(7, 0.50, 0.25, NULL, 2, 3),
(8, 0.50, 0.25, NULL, 2, 4),

(9 , 1.75, 2.00, 2.50, 3, 1), -- rep af
(10, 1.75, 2.00, 2.50, 3, 2), 
(11, 1.75, 2.00, 2.50, 3, 3), 
(12, 1.75, 2.00, 2.50, 3, 4), 

(13, 2.80, 4.00, NULL, 4, 1), -- ap dir
(14, 2.80, 4.00, NULL, 4, 2), 
(15, 2.80, 4.00, NULL, 4, 3), 
(16, 2.80, 4.00, NULL, 4, 4), 

(17,  2.75, 1.25, 3.00, 5, 1), -- rep af
(18,  2.75, 1.25, 3.00, 5, 2), 
(19,  2.75, 1.25, 3.00, 5, 3), 
(20,  2.75, 1.25, 3.00, 5, 4), 

(21, 1.75, 2.50, 3.00, 6, 1), -- rep af
(22, 1.75, 2.50, 3.00, 6, 2), 
(23, 1.75, 2.50, 3.00, 6, 3), 
(24, 1.75, 2.50, 3.00, 6, 4), 

(25, 4.75, 3.25, NULL, 7, 1), -- ap dir
(26, 3.25, 4.75, NULL, 7, 2), 
(27, 5.00, 3.00, NULL, 7, 3), 
(28, 3.00, 5.00, NULL, 7, 4), 

(29, 0.50, 2.25, 3.00, 8, 1), -- rep af
(30, 0.50, 2.25, 3.00, 8, 2), 
(31, 0.50, 2.25, 3.00, 8, 3), 
(32, 0.50, 2.25, 3.00, 8, 4), 

(33, 5.00, 5.00, NULL, 9, 1), -- ap dir
(34, 4.15, 2.25, NULL, 9, 2), 
(35, 2.25, 4.25, NULL, 9, 3), 
(36, 3.75, 3.25, NULL, 9, 4), 

(37, 2.75, 3.00, 3.00, 10, 1), -- ap af
(38, 2.75, 3.00, 3.00, 10, 2), 
(39, 2.75, 3.00, 3.00, 10, 3), 
(40, 2.75, 3.00, 3.00, 10, 4), 

-- AVALIACAO TURMA B 3.2.4
(41, 0.25, 0.25, NULL, 11, 5), -- rep dir
(42, 0.25, 0.25, NULL, 11, 6), 
(43, 0.25, 0.25, NULL, 11, 7), 
(44, 0.25, 0.25, NULL, 11, 8), 

(45, 4.25, 4.75, NULL, 12, 5), -- ap dir
(46, 2.25, 3.85, NULL, 12, 6), 
(47, 3.90, 2.10, NULL, 12, 7), 
(48, 2.65, 4.70, NULL, 12, 8), 

(49, 2.85, 2.25, NULL, 13, 5), -- af
(50, 2.85, 2.25, NULL, 13, 6), 
(51, 2.85, 2.25, NULL, 13, 7), 
(52, 2.85, 2.25, NULL, 13, 8), 

(53, 1.65, 4.10, NULL, 14, 5), -- af
(54, 1.65, 4.10, NULL, 14, 6), 
(55, 1.65, 4.10, NULL, 14, 7), 
(56, 1.65, 4.10, NULL, 14, 8), 

(57, 2.00, 1.20, NULL, 15, 5), -- af
(58, 2.00, 1.20, NULL, 15, 6), 
(59, 2.00, 1.20, NULL, 15, 7), 
(60, 2.00, 1.20, NULL, 15, 8), 

(61, 4.50, 2.25, NULL, 16, 5), -- ap dir
(62, 3.75, 2.75, NULL, 16, 6), 
(63, 2.75, 4.00, NULL, 16, 7), 
(64, 3.00, 3.00, NULL, 16, 8), 

(65, 3.75, 1.25, NULL, 17, 5), -- af
(66, 3.75, 1.25, NULL, 17, 6), 
(67, 3.75, 1.25, NULL, 17, 7),
(68, 3.75, 1.25, NULL, 17, 8),

(69, 1.20, 4.45, NULL, 18, 5), -- af
(70, 1.20, 4.45, NULL, 18, 6), 
(71, 1.20, 4.45, NULL, 18, 7), 
(72, 1.20, 4.45, NULL, 18, 8), 

(73, 4.75, 3.75, NULL, 19, 5), -- ap dir
(74, 4.75, 3.75, NULL, 19, 6),
(75, 4.75, 3.75, NULL, 19, 7),
(76, 4.75, 3.75, NULL, 19, 8),

(77, 4.25, 3.25, NULL, 20, 5), -- ap dir
(78, 4.25, 3.25, NULL, 20, 6),
(79, 4.25, 3.25, NULL, 20, 7),
(80, 4.25, 3.25, NULL, 20, 8);

-- SELECT 4.1
SELECT 
	PROFESSOR.NOME_PROFESSOR 		AS "PROFESSOR", 
	PROFESSOR.TITULACAO				AS "TITULO", 
	DISCIPLINA.NOM_DISCIPLINA 		AS "DISCIPLINA", 
    TURMA.DTA_INICIO_AULAS 			AS "INÍCIO AULAS", 
    TURMA.DTA_FIM_AULAS 			AS "FIM AULAS", 
    COUNT(ALUNO.RA) 				AS "QTDE ALUNOS",
    DISCIPLINA_OFERECIDA.BLOCO		AS "BLOCO", 
    DISCIPLINA_OFERECIDA.SALA		AS "SALA", 
		CASE DISCIPLINA_OFERECIDA.DIA_SEMANA
			WHEN '1' THEN 'DOMINGO'
			WHEN '2' THEN 'SEGUNDA-FEIRA'
			WHEN '3' THEN 'TERÇA-FEIRA'
			WHEN '4' THEN 'QUARTA-FEIRA'
			WHEN '5' THEN 'QUINTA-FEIRA'
			WHEN '6' THEN 'SEXTA-FEIRA'
			WHEN '7' THEN 'SABADO'
		END 						AS "DIA SEMANA",
    DISCIPLINA_OFERECIDA.HOR_INICIO AS "HORÁRIO INÍCIO", 
    DISCIPLINA_OFERECIDA.HOR_FIM 	AS "HORÁRIO FIM"
FROM DISCIPLINA_OFERECIDA
JOIN TURMA 		ON TURMA.NUM_TURMA 				= DISCIPLINA_OFERECIDA.NUM_TURMA
JOIN DISCIPLINA ON DISCIPLINA.COD_DISCIPLINA 	= DISCIPLINA_OFERECIDA.COD_DISCIPLINA
JOIN PROFESSOR 	ON PROFESSOR.MATRICULA 			= DISCIPLINA_OFERECIDA.MATRICULA
JOIN MATRICULA 	ON MATRICULA.NUM_TURMA 			= TURMA.NUM_TURMA
JOIN ALUNO 		ON ALUNO.RA 					= MATRICULA.RA
GROUP BY DISCIPLINA.NOM_DISCIPLINA,
 	PROFESSOR.NOME_PROFESSOR,
 	PROFESSOR.TITULACAO,
 	TURMA.DTA_INICIO_AULAS,
 	TURMA.DTA_FIM_AULAS,
 	DISCIPLINA_OFERECIDA.BLOCO,
 	DISCIPLINA_OFERECIDA.SALA,
	DISCIPLINA_OFERECIDA.DIA_SEMANA, 
 	DISCIPLINA_OFERECIDA.HOR_INICIO, 
	DISCIPLINA_OFERECIDA.HOR_FIM
ORDER BY DISCIPLINA_OFERECIDA.SALA ASC;

-- SEGUNDO SELECT DO TRABALHO 4.2
SELECT 
	DISCIPLINA.NOM_DISCIPLINA 		AS "DISCIPLINA", 
	PROFESSOR.NOME_PROFESSOR 		AS "PROFESSOR", 
    DISCIPLINA_OFERECIDA.BLOCO		AS "BLOCO", 
    DISCIPLINA_OFERECIDA.SALA		AS "SALA", 
    CASE DISCIPLINA_OFERECIDA.DIA_SEMANA
		WHEN '1' THEN 'DOMINGO'
        WHEN '2' THEN 'SEGUNDA-FEIRA'
        WHEN '3' THEN 'TERÇA-FEIRA'
        WHEN '4' THEN 'QUARTA-FEIRA'
        WHEN '5' THEN 'QUINTA-FEIRA'
        WHEN '6' THEN 'SEXTA-FEIRA'
		WHEN '7' THEN 'SABADO'
	END 							AS "DIA SEMANA",
	DISCIPLINA_OFERECIDA.HOR_INICIO AS "HORÁRIO INÍCIO", 
    DISCIPLINA_OFERECIDA.HOR_FIM 	AS "HORÁRIO FIM",
    ALUNO.RA 						AS "RA",
    ALUNO.NOME_ALUNO 				AS "NOME"
FROM DISCIPLINA_OFERECIDA
JOIN TURMA 		ON TURMA.NUM_TURMA = DISCIPLINA_OFERECIDA.NUM_TURMA
JOIN DISCIPLINA 	ON DISCIPLINA.COD_DISCIPLINA = DISCIPLINA_OFERECIDA.COD_DISCIPLINA
JOIN PROFESSOR 	ON PROFESSOR.MATRICULA = DISCIPLINA_OFERECIDA.MATRICULA
JOIN MATRICULA 	ON MATRICULA.NUM_TURMA = TURMA.NUM_TURMA
JOIN ALUNO 		ON ALUNO.RA = MATRICULA.RA
WHERE MATRICULA.DTA_MATRICULA >= '2023/01/01'
GROUP BY DISCIPLINA.NOM_DISCIPLINA,
	 PROFESSOR.NOME_PROFESSOR,
	 DISCIPLINA_OFERECIDA.BLOCO,
	 DISCIPLINA_OFERECIDA.SALA,
	 DISCIPLINA_OFERECIDA.DIA_SEMANA,
	 DISCIPLINA_OFERECIDA.HOR_INICIO, 
	 DISCIPLINA_OFERECIDA.HOR_FIM,
	 ALUNO.RA,
	 ALUNO.NOME_ALUNO
ORDER BY ALUNO.RA ASC;

-- SELECT 4.3
-- TURMA A = AVALIAÇAO DA TURMA A=1
SELECT 
	DIS.NOM_DISCIPLINA AS 'DISCIPLINA', 
    PRO.NOME_PROFESSOR AS 'PROFESSOR', 
    DIO.BLOCO, 
    DIO.SALA, 
    CASE DIO.DIA_SEMANA WHEN 1 THEN 'DOMINGO'
						WHEN '2' THEN 'SEGUNDA-FEIRA'
						WHEN '3' THEN 'TERÇA-FEIRA'
						WHEN '4' THEN 'QUARTA-FEIRA'
						WHEN '5' THEN 'QUINTA-FEIRA'
						WHEN '6' THEN 'SEXTA-FEIRA'
						WHEN '7' THEN 'SABADO' END AS 'DIA SEMANA',
    DIO.HOR_INICIO AS 'HORÁRIO INICIO', 
    DIO.HOR_FIM AS	'HORÁRIO FIM', 
    AL.RA, 
    AL.NOME_ALUNO AS 'NOME', 
    AVA.NOTA_A2 AS 'NOTA A2', 
    AVA.NOTA_A1 AS 'NOTA A1', 
    AVA.NOTA_AF AS 'NOTA AF',
   
    
    CASE WHEN AVA.NOTA_A2 + AVA.NOTA_A1 >= 6 THEN 'APROVADO'
		 WHEN AVA.NOTA_A2 + AVA.NOTA_A1 < 1 THEN 'REPROVADO'
         WHEN AVA.NOTA_AF + AVA.NOTA_A1 >= 6 THEN 'APROVADO POR AF'
         WHEN AVA.NOTA_AF + AVA.NOTA_A2 >= 6 THEN 'APROVADO POR AF'
         
         ELSE 'REPROVADO'
         END 'SITUAÇÃO ALUNO'
FROM 
	TRABALHO.ALUNO AL
    JOIN TRABALHO.AVALIACAO AVA 			ON 			AL.RA = AVA.RA
    JOIN TRABALHO.DISCIPLINA_OFERECIDA DIO ON			AVA.NUM_DISCIPLINA_OFERECIDA = DIO.NUM_DISCIPLINA_OFERECIDA
    JOIN TRABALHO.PROFESSOR PRO 			ON			DIO.MATRICULA = PRO.MATRICULA
    JOIN TRABALHO.DISCIPLINA DIS 			ON			DIO.COD_DISCIPLINA = DIS.COD_DISCIPLINA
    JOIN TRABALHO.TURMA TUR 				ON			DIO.NUM_TURMA = TUR.NUM_TURMA
WHERE TUR.NUM_TURMA = 1;
